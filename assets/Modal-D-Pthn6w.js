import{V as ee,r as f,L as te,W as ne,g as M,a as L,s as w,u as W,v as z,j as l,e as R,X as b,Y as E,f as T,Z as se,k as V,c as F,m as oe,x as ie,h as N,_ as ae,I as _,t as re}from"./index-BpN6Oh9O.js";import{n as le,i as ce,B as g,T as C,e as ue}from"./TextField-BCWqjyrI.js";import{g as de,A as D,f as me,m as pe,n as fe,h as he,k as ge}from"./index-DgKuPVcZ.js";function xe(e,t,n,s,i){const[o,a]=f.useState(()=>i&&n?n(e).matches:s?s(e).matches:t);return te(()=>{if(!n)return;const c=n(e),r=()=>{a(c.matches)};return r(),c.addEventListener("change",r),()=>{c.removeEventListener("change",r)}},[e,n]),o}const ve={...ne},Q=ve.useSyncExternalStore;function ye(e,t,n,s,i){const o=f.useCallback(()=>t,[t]),a=f.useMemo(()=>{if(i&&n)return()=>n(e).matches;if(s!==null){const{matches:m}=s(e);return()=>m}return o},[o,e,s,i,n]),[c,r]=f.useMemo(()=>{if(n===null)return[o,()=>()=>{}];const m=n(e);return[()=>m.matches,u=>(m.addEventListener("change",u),()=>{m.removeEventListener("change",u)})]},[o,n,e]);return Q(r,c,a)}function Ce(e={}){const{themeId:t}=e;return function(s,i={}){let o=ee();o&&t&&(o=o[t]||o);const a=typeof window<"u"&&typeof window.matchMedia<"u",{defaultMatches:c=!1,matchMedia:r=a?window.matchMedia:null,ssrMatchMedia:d=null,noSsr:m=!1}=de({name:"MuiUseMediaQuery",props:i,theme:o});let u=typeof s=="function"?s(o):s;return u=u.replace(/^@media( ?)/m,""),(Q!==void 0?ye:xe)(u,c,r,d,m)}}function we(e){return String(e).match(/[\d.\-+]*\s*(.*)/)[1]||""}function be(e){return parseFloat(e)}const O=f.createContext();function Se(e){return M("MuiGrid",e)}const ke=[0,1,2,3,4,5,6,7,8,9,10],je=["column-reverse","column","row-reverse","row"],$e=["nowrap","wrap-reverse","wrap"],x=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],v=L("MuiGrid",["root","container","item","zeroMinWidth",...ke.map(e=>`spacing-xs-${e}`),...je.map(e=>`direction-xs-${e}`),...$e.map(e=>`wrap-xs-${e}`),...x.map(e=>`grid-xs-${e}`),...x.map(e=>`grid-sm-${e}`),...x.map(e=>`grid-md-${e}`),...x.map(e=>`grid-lg-${e}`),...x.map(e=>`grid-xl-${e}`)]);function Ie({theme:e,ownerState:t}){let n;return e.breakpoints.keys.reduce((s,i)=>{let o={};if(t[i]&&(n=t[i]),!n)return s;if(n===!0)o={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(n==="auto")o={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const a=b({values:t.columns,breakpoints:e.breakpoints.values}),c=typeof a=="object"?a[i]:a;if(c==null)return s;const r=`${Math.round(n/c*1e8)/1e6}%`;let d={};if(t.container&&t.item&&t.columnSpacing!==0){const m=e.spacing(t.columnSpacing);if(m!=="0px"){const u=`calc(${r} + ${m})`;d={flexBasis:u,maxWidth:u}}}o={flexBasis:r,flexGrow:0,maxWidth:r,...d}}return e.breakpoints.values[i]===0?Object.assign(s,o):s[e.breakpoints.up(i)]=o,s},{})}function Me({theme:e,ownerState:t}){const n=b({values:t.direction,breakpoints:e.breakpoints.values});return E({theme:e},n,s=>{const i={flexDirection:s};return s.startsWith("column")&&(i[`& > .${v.item}`]={maxWidth:"none"}),i})}function X({breakpoints:e,values:t}){let n="";Object.keys(t).forEach(i=>{n===""&&t[i]!==0&&(n=i)});const s=Object.keys(e).sort((i,o)=>e[i]-e[o]);return s.slice(0,s.indexOf(n))}function Le({theme:e,ownerState:t}){const{container:n,rowSpacing:s}=t;let i={};if(n&&s!==0){const o=b({values:s,breakpoints:e.breakpoints.values});let a;typeof o=="object"&&(a=X({breakpoints:e.breakpoints.values,values:o})),i=E({theme:e},o,(c,r)=>{const d=e.spacing(c);return d!=="0px"?{marginTop:`calc(-1 * ${d})`,[`& > .${v.item}`]:{paddingTop:d}}:a!=null&&a.includes(r)?{}:{marginTop:0,[`& > .${v.item}`]:{paddingTop:0}}})}return i}function We({theme:e,ownerState:t}){const{container:n,columnSpacing:s}=t;let i={};if(n&&s!==0){const o=b({values:s,breakpoints:e.breakpoints.values});let a;typeof o=="object"&&(a=X({breakpoints:e.breakpoints.values,values:o})),i=E({theme:e},o,(c,r)=>{const d=e.spacing(c);if(d!=="0px"){const m=`calc(-1 * ${d})`;return{width:`calc(100% + ${d})`,marginLeft:m,[`& > .${v.item}`]:{paddingLeft:d}}}return a!=null&&a.includes(r)?{}:{width:"100%",marginLeft:0,[`& > .${v.item}`]:{paddingLeft:0}}})}return i}function Re(e,t,n={}){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return[n[`spacing-xs-${String(e)}`]];const s=[];return t.forEach(i=>{const o=e[i];Number(o)>0&&s.push(n[`spacing-${i}-${String(o)}`])}),s}const Ee=w("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e,{container:s,direction:i,item:o,spacing:a,wrap:c,zeroMinWidth:r,breakpoints:d}=n;let m=[];s&&(m=Re(a,d,t));const u=[];return d.forEach(p=>{const h=n[p];h&&u.push(t[`grid-${p}-${String(h)}`])}),[t.root,s&&t.container,o&&t.item,r&&t.zeroMinWidth,...m,i!=="row"&&t[`direction-xs-${String(i)}`],c!=="wrap"&&t[`wrap-xs-${String(c)}`],...u]}})(({ownerState:e})=>({boxSizing:"border-box",...e.container&&{display:"flex",flexWrap:"wrap",width:"100%"},...e.item&&{margin:0},...e.zeroMinWidth&&{minWidth:0},...e.wrap!=="wrap"&&{flexWrap:e.wrap}}),Me,Le,We,Ie);function Te(e,t){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return[`spacing-xs-${String(e)}`];const n=[];return t.forEach(s=>{const i=e[s];if(Number(i)>0){const o=`spacing-${s}-${String(i)}`;n.push(o)}}),n}const Ne=e=>{const{classes:t,container:n,direction:s,item:i,spacing:o,wrap:a,zeroMinWidth:c,breakpoints:r}=e;let d=[];n&&(d=Te(o,r));const m=[];r.forEach(p=>{const h=e[p];h&&m.push(`grid-${p}-${String(h)}`)});const u={root:["root",n&&"container",i&&"item",c&&"zeroMinWidth",...d,s!=="row"&&`direction-xs-${String(s)}`,a!=="wrap"&&`wrap-xs-${String(a)}`,...m]};return T(u,Se,t)},st=f.forwardRef(function(t,n){const s=W({props:t,name:"MuiGrid"}),{breakpoints:i}=z(),o=le(s),{className:a,columns:c,columnSpacing:r,component:d="div",container:m=!1,direction:u="row",item:p=!1,rowSpacing:h,spacing:S=0,wrap:H="wrap",zeroMinWidth:K=!1,...k}=o,Z=h||S,Y=r||S,J=f.useContext(O),A=m?c||12:J,G={},P={...k};i.keys.forEach(y=>{k[y]!=null&&(G[y]=k[y],delete P[y])});const B={...o,columns:A,container:m,direction:u,item:p,rowSpacing:Z,columnSpacing:Y,wrap:H,zeroMinWidth:K,spacing:S,...G,breakpoints:i.keys},q=Ne(B);return l.jsx(O.Provider,{value:A,children:l.jsx(Ee,{ownerState:B,className:R(q.root,a),as:d,ref:n,...P})})}),Ae=Ce({themeId:se});function Ge(e){return M("MuiListItemAvatar",e)}L("MuiListItemAvatar",["root","alignItemsFlexStart"]);const Pe=e=>{const{alignItems:t,classes:n}=e;return T({root:["root",t==="flex-start"&&"alignItemsFlexStart"]},Ge,n)},Be=w("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.alignItems==="flex-start"&&t.alignItemsFlexStart]}})({minWidth:56,flexShrink:0,variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}),ot=f.forwardRef(function(t,n){const s=W({props:t,name:"MuiListItemAvatar"}),{className:i,...o}=s,a=f.useContext(ce),c={...s,alignItems:a.alignItems},r=Pe(c);return l.jsx(Be,{className:R(r.root,i),ownerState:c,ref:n,...o})});function Oe(e){return M("MuiSkeleton",e)}L("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const Ue=e=>{const{classes:t,variant:n,animation:s,hasChildren:i,width:o,height:a}=e;return T({root:["root",n,s,i&&"withChildren",i&&!o&&"fitContent",i&&!a&&"heightAuto"]},Oe,t)},j=V`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`,$=V`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`,ze=typeof j!="string"?F`
        animation: ${j} 2s ease-in-out 0.5s infinite;
      `:null,Ve=typeof $!="string"?F`
        &::after {
          animation: ${$} 2s linear 0.5s infinite;
        }
      `:null,Fe=w("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],n.animation!==!1&&t[n.animation],n.hasChildren&&t.withChildren,n.hasChildren&&!n.width&&t.fitContent,n.hasChildren&&!n.height&&t.heightAuto]}})(oe(({theme:e})=>{const t=we(e.shape.borderRadius)||"px",n=be(e.shape.borderRadius);return{display:"block",backgroundColor:e.vars?e.vars.palette.Skeleton.bg:ie(e.palette.text.primary,e.palette.mode==="light"?.11:.13),height:"1.2em",variants:[{props:{variant:"text"},style:{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${n}${t}/${Math.round(n/.6*10)/10}${t}`,"&:empty:before":{content:'"\\00a0"'}}},{props:{variant:"circular"},style:{borderRadius:"50%"}},{props:{variant:"rounded"},style:{borderRadius:(e.vars||e).shape.borderRadius}},{props:({ownerState:s})=>s.hasChildren,style:{"& > *":{visibility:"hidden"}}},{props:({ownerState:s})=>s.hasChildren&&!s.width,style:{maxWidth:"fit-content"}},{props:({ownerState:s})=>s.hasChildren&&!s.height,style:{height:"auto"}},{props:{animation:"pulse"},style:ze||{animation:`${j} 2s ease-in-out 0.5s infinite`}},{props:{animation:"wave"},style:{position:"relative",overflow:"hidden",WebkitMaskImage:"-webkit-radial-gradient(white, black)","&::after":{background:`linear-gradient(
                90deg,
                transparent,
                ${(e.vars||e).palette.action.hover},
                transparent
              )`,content:'""',position:"absolute",transform:"translateX(-100%)",bottom:0,left:0,right:0,top:0}}},{props:{animation:"wave"},style:Ve||{"&::after":{animation:`${$} 2s linear 0.5s infinite`}}}]}})),_e=f.forwardRef(function(t,n){const s=W({props:t,name:"MuiSkeleton"}),{animation:i="pulse",className:o,component:a="span",height:c,style:r,variant:d="text",width:m,...u}=s,p={...s,animation:i,component:a,variant:d,hasChildren:!!u.children},h=Ue(p);return l.jsx(Fe,{as:a,ref:n,className:R(h.root,o),ownerState:p,...u,style:{width:m,height:c,...r}})}),it=N(l.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H6l-2 2V4h16z"}),"ChatBubbleOutline"),at=N(l.jsx("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite"),U=N(l.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder"),I=e=>{const[t,n]=f.useState(e),[s,i]=f.useState(e),o=f.useCallback(async(a,c=()=>{})=>{i(t);const r=a(t);n(r);try{await c()}catch(d){throw n(s),d}},[t,s]);return[t,o]},De=({post:e,isMobile:t})=>{var i,o;const[n,s]=f.useState(!1);return l.jsxs(g,{sx:{width:t?"100%":"60%",height:t?"50%":"100%",bgcolor:"black",display:"flex",alignItems:"center",position:"relative"},children:[(!n||!e)&&l.jsx(_e,{variant:"rectangular",width:"100%",height:"100%",sx:{position:"absolute",top:0,left:0,bgcolor:"grey.800"}}),l.jsx("img",{src:(o=(i=e==null?void 0:e.media)==null?void 0:i[0])==null?void 0:o.url,alt:(e==null?void 0:e.caption)||"Image",style:{width:"100%",height:"100%",objectFit:"contain",display:n?"block":"none"},onLoad:()=>s(!0),onError:()=>s(!0)})]})},Qe=ae.injectEndpoints({endpoints:e=>({addComment:e.mutation({query:t=>({url:"/comment/create",method:"POST",body:t,headers:{"Content-Type":"application/json"}}),invalidatesTags:["PostComments"]}),likeComment:e.mutation({query:t=>({url:`/comment/${t}/like`,method:"POST"}),invalidatesTags:["PostComments"]}),unlikeComment:e.mutation({query:t=>({url:`/comment/${t}/unlike`,method:"POST"}),invalidatesTags:["PostComments"]})})}),{useAddCommentMutation:Xe,useLikeCommentMutation:He,useUnlikeCommentMutation:Ke}=Qe,Ze=({comment:e})=>{const[t,n]=I(!!(e!=null&&e.isLiked)),[s,i]=I((e==null?void 0:e.likesCount)||0),[o]=He(),[a]=Ke(),c=()=>{n(r=>!r,async()=>{t?await a(e._id).unwrap().then(()=>{i(r=>r-1)}):await o(e._id).unwrap().then(()=>{i(r=>r+1)})})};return l.jsxs(g,{sx:{display:"flex",alignItems:"flex-start",mb:2},children:[l.jsx(D,{src:e.user.profileImage,sx:{width:32,height:32,mr:1}}),l.jsxs(g,{sx:{flex:1,width:"80%"},children:[l.jsxs(C,{variant:"body2",sx:{fontWeight:600,fontSize:"0.85rem"},children:[e.user.userName," ",l.jsx("span",{style:{fontWeight:400},children:e.content})]}),l.jsx(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:.5},children:l.jsx(g,{sx:{display:"flex",alignItems:"center",gap:1},children:l.jsxs(C,{variant:"caption",sx:{color:"text.secondary",fontSize:"0.75rem"},children:[s," likes"]})})})]}),l.jsx(_,{size:"small",sx:{p:2},onClick:c,children:t?l.jsx(U,{color:"secondary",fontSize:"small"}):l.jsx(U,{fontSize:"small"})})]})},Ye=({comments:e})=>l.jsx(g,{sx:{flex:1,overflow:"auto",p:2},children:e==null?void 0:e.map((t,n)=>l.jsx(Ze,{comment:t},n))}),Je=e=>{const{post:t,refetch:n}=e,[s,i]=I(e.comments||[]),[o,a]=f.useState(""),[c,r]=Xe(),d=re(u=>{var p;return(p=u.auth)==null?void 0:p.user});f.useEffect(()=>{var u,p,h;((p=(u=e.comments)==null?void 0:u[0])==null?void 0:p._id)!==((h=s==null?void 0:s[0])==null?void 0:h._id)&&i(()=>e.comments)},[e.comments]);const m=async u=>{if(u.preventDefault(),!!o)try{const p={postId:t._id,content:o};await i(h=>[{_id:Math.random().toString(36).substr(2,9),post:t._id,likesCount:0,user:d,createdAt:new Date().toISOString(),...p}].concat(h),async()=>{await c(p).unwrap().then(()=>a(""))})}catch(p){console.error(p)}finally{n()}};return l.jsxs(l.Fragment,{children:[l.jsx(Ye,{comments:s}),l.jsx(g,{component:"form",sx:{p:2,borderTop:1,borderColor:"divider"},children:l.jsx(ue,{fullWidth:!0,value:o,disabled:r==null?void 0:r.isLoading,onChange:u=>a(u.target.value),onKeyDown:u=>u.key==="Enter"&&m(u),placeholder:"Add a comment...",variant:"standard",sx:{"& .MuiInput-underline:before":{borderBottom:"none"}}})})]})},qe=w(me)(({theme:e})=>({"& .MuiDialog-paper":{maxWidth:"1200px",maxHeight:"90vh",margin:"16px",borderRadius:"8px",overflow:"hidden"}})),rt=({open:e,onClose:t,post:n})=>{var r,d,m,u;const s=z(),i=Ae(s.breakpoints.down("sm")),{data:o}=pe(n._id),{data:a,...c}=fe(n._id);return l.jsx(qe,{open:e,onClose:t,maxWidth:!1,"aria-labelledby":"comment-modal",fullScreen:i,children:l.jsx(he,{sx:{p:0},children:l.jsxs(g,{sx:{display:"flex",flexDirection:i?"column":"row",height:i?"100%":"90vh"},children:[l.jsx(De,{post:o==null?void 0:o.payload,isMobile:i}),l.jsxs(g,{sx:{width:i?"100%":"40%",height:i?"50%":"100%",display:"flex",flexDirection:"column"},children:[l.jsxs(g,{sx:{p:2,display:"flex",alignItems:"center",borderBottom:1,borderColor:"divider"},children:[l.jsx(D,{src:(d=(r=o==null?void 0:o.payload)==null?void 0:r.user)==null?void 0:d.profileImage}),l.jsx(C,{variant:"subtitle2",sx:{ml:1,fontWeight:600},children:(u=(m=o==null?void 0:o.payload)==null?void 0:m.user)==null?void 0:u.userName}),l.jsx(_,{onClick:t,sx:{ml:"auto"},children:l.jsx(ge,{})})]}),c.isLoading?l.jsx(C,{children:"Loading comments..."}):l.jsx(Je,{post:n,comments:a==null?void 0:a.payload,refetch:c.refetch})]})]})})})};export{it as C,at as F,st as G,ot as L,_e as S,U as a,rt as b,Ae as c,I as u};
